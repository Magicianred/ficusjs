function toKebabCase(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function createCustomElement(t,e){const s=function(t){if(!t)return[];const e=[];return Object.keys(t).forEach((s=>{(null==t[s].observed||t[s].observed)&&e.push(toKebabCase(s))})),e}(e.props);globalThis.customElements.get(t)||globalThis.customElements.define(t,class extends globalThis.HTMLElement{static get observedAttributes(){return s}get componentTagName(){return t}connectedCallback(){null==this.connectedCallbackCount&&(this.connectedCallbackCount=0),this.connectedCallbackCount=this.connectedCallbackCount+1,this._checkInit(),this._preprocess()}disconnectedCallback(){"function"==typeof this.removed&&(this.removed(),this.isRemovedCalled=!0)}attributeChangedCallback(){null!=this.connectedCallbackCount&&(this._checkInit(),this._preprocess())}get initialised(){return this._props&&this._computed&&this.templateRenderer}_checkInit(){this.initialised||this._init(e)}_init(t){this._props=t.props||{},this._computed=t.computed||{},this.computedCache={},this.status="render",this.connectedCallbackCount=0,this.props=this._processProps(),this.root=this._processRoot(t.root),this.slots=this._processSlots(),this.render=t.render||null,this.templateRenderer=t.renderer,this.template=null,this.created=t.created||null,this.mounted=t.mounted||null,this.updated=t.updated||null,this.removed=t.removed||null,this.isCreatedCalled=!1,this.isMountedCalled=!1,this.isRemovedCalled=!1,this.emit=(t,e)=>{!function(t,e,s={}){const o=Object.assign({},{bubbles:!0,cancelable:!0,composed:!1},s),n=globalThis.document.createEvent("CustomEvent");n.initCustomEvent(e,o.bubbles,o.cancelable,o.detail),Object.defineProperty(n,"composed",{value:o.composed}),t.dispatchEvent(n)}(this,t,{detail:e})},this._processMethodsAndComputedProps(t),this._processInstanceProps(this._props),"function"!=typeof this.created||this.isCreatedCalled||(this.created(),this.isCreatedCalled=!0)}_processProps(){const t={};return Object.keys(this._props).forEach((e=>{const s={},o=this._props[e],n=this._getAttribute(e);let r=null;if(null!=o.default&&(r=o.default),o.required&&null==n)null!=r?(console.info(`No biggie, the required prop '${e}' has no value set, so the default has been set`),s[e]=r):(s[e]=null,console.error(`The required prop '${e}' has no value set`));else switch(o.type){case String:default:s[e]=n||r;break;case Number:s[e]=null!=n?parseFloat(n):null!=r?r:0;break;case Boolean:s[e]=null!=n?"true"===n.toString():null!=r&&r;break;case Object:try{s[e]=null!=n?JSON.parse(n):null!=r?r:void 0}catch(t){s[e]=null!=r?r:void 0,console.error(`An object prop parse issue occurred with prop ${e} and value ${n}`)}}t[e]=s[e],this._instanceProps&&this._instanceProps[e]&&(t[e]=this._instanceProps[e])})),t}_processMethodsAndComputedProps(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]||"function"!=typeof t[s]||(e[s]=t[s].bind(e)),"computed"===s&&this._processComputed(t[s])}))}_processRoot(t){switch(t){case"standard":default:return this;case"shadow":return this.attachShadow({mode:"open"});case"shadow:closed":return this.attachShadow({mode:"closed"})}}_processComputed(t){const e=this,s=Object.keys(t);s.length&&s.forEach((s=>{e[s]?console.warn(`Computed property '${s}' already exists on the component instance`):Object.defineProperty(e,s,{get:()=>(e.computedCache[s]||(e.computedCache[s]=t[s].bind(e)()),e.computedCache[s])})}))}_processRender(){const t=this.render?this.render():void 0;t&&(this.template=t,this._updateRender())}_processSlots(){const t=this.childNodes,e={default:[]};return t.length>0&&[...t].forEach((t=>{const s=t.getAttribute?t.getAttribute("slot"):null;s?e[s]=t:e.default.push(t)})),e}_getAttribute(t){try{return this.getAttribute(toKebabCase(t))}catch(t){return console.error("A get prop error occurred",t),""}}_processInstanceProps(t){const e=this,s=Object.keys(t);t&&s.forEach((t=>{let s;e[t]&&(s=e[t],delete e[t]),Object.defineProperty(e,t,{get(){return this._instanceProps&&this._instanceProps[t]?this._instanceProps[t]:this.getAttribute(toKebabCase(t))},set(e){return this._instanceProps||(this._instanceProps={}),this._instanceProps[t]=e,this.setAttribute(toKebabCase(t),"object"==typeof e?JSON.stringify(e):e.toString()),!0},enumerable:!0}),s&&(e[t]=s)}))}_preprocess(){this.computedCache={},this.props=this._processProps(),this._processRender()}_updateRender(){var t;this.template&&("object"!=typeof(t=this.template)&&"function"!=typeof t||"function"!=typeof t.then?(this.templateRenderer(this.template,this.root),this._callLifecycleMethods()):this.template.then((t=>{this.templateRenderer(t,this.root),this._callLifecycleMethods()})).catch((t=>console.error("A component render error occurred",t))))}_callLifecycleMethods(){"function"!=typeof this.mounted||this.isMountedCalled||this.mounted(),this.isMountedCalled=!0,"function"==typeof this.updated&&this.isMountedCalled&&this.updated()}})}function createComponent(t,e){createCustomElement(t,function(t){return{...t,created(){if(t.state&&"function"!=typeof t.state)throw new Error("State must be a function!");this._state=t.state||{},"function"==typeof this._state&&(this._state=this._state.bind(this)()),this.state=this._monitorState(this._state),this.setState=(t,e)=>{const setter=t=>{if(!t||"object"!=typeof t)return;const s=this.updated;e&&(this.updated=()=>{e(),this.updated=s||void 0}),this.status="transaction";for(const e in t)this.state[e]&&this.state[e]===t[e]||(this.state[e]=t[e]);this.status="render",this._processRender()},s=t(this.state);var o;"object"!=typeof(o=s)&&"function"!=typeof o||"function"!=typeof o.then?setter(s):s.then(setter)},t.created&&t.created.call(this)},_monitorState(t){const e=this;return new Proxy(t,{set:(t,s,o)=>(t[s]===o||(t[s]=o,e.computedCache={},"render"===e.status&&e._processRender()),!0)})}}}(e))}function use(t,{renderer:e,...s}){if(t.create&&"function"==typeof t.create)return t.create({createComponent:createComponent,renderer:e,...s,use:use})}export{createComponent,use};
