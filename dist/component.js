function t(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()}function e(e,s){const r=function(e){if(!e)return[];const s=[];return Object.keys(e).forEach(r=>{(null==e[r].observed||e[r].observed)&&s.push(t(r))}),s}(s.props);window.customElements.get(e)||window.customElements.define(e,class extends HTMLElement{static get observedAttributes(){return r}get initialised(){return this._props&&this._state&&this._computed&&this.templateRenderer}connectedCallback(){this._checkInit(),this._preprocess(),"function"!=typeof this.mounted||this.isMountedCalled||(this.mounted(),this.isMountedCalled=!0),"function"==typeof this.updated&&this.isMountedCalled&&this.updated()}disconnectedCallback(){"function"==typeof this.removed&&(this.removed(),this.isRemovedCalled=!0)}attributeChangedCallback(){this._checkInit(),this._preprocess()}_checkInit(){this.initialised||this._init(s)}_init(t){if(this._props=t.props||{},this._computed=t.computed||{},t.state&&"function"!=typeof t.state)throw new Error("State must be a function!");this._state=t.state||{},this.computedCache={},this.subscribeCallback=()=>{this.computedCache={},this._processRender()},this.props=this._processProps(),"function"==typeof this._state&&(this._state=this._state.bind(this)()),this.state=this._monitorState(this._state),this._processInitProps(t),this.root=this._processRoot(t.root),this.slots=this._processSlots(),this.render=t.render||null,this.templateRenderer=t.renderer,this.template=null,this.created=t.created||null,this.mounted=t.mounted||t.ready||null,this.updated=t.updated||null,this.removed=t.removed||null,this.isCreatedCalled=!1,this.isMountedCalled=!1,this.isRemovedCalled=!1,this.emit=(t,e)=>{emit(this,t,{detail:e})},this._processInstanceProps(this._props),"function"!=typeof this.created||this.isCreatedCalled||(this.created(),this.isCreatedCalled=!0)}_processProps(){const t={};return Object.keys(this._props).forEach(e=>{const s={},r=this._props[e],o=this._getAttribute(e);let i=null;if(null!=r.default&&(i=r.default),r.required&&null==o)null!=i?(console.info(`No biggie, the required prop '${e}' has no value set, so the default has been set`),s[e]=i):(s[e]=null,console.error(`The required prop '${e}' has no value set`));else switch(r.type){case String:default:s[e]=o||i;break;case Number:s[e]=null!=o?parseFloat(o):null!=i?i:0;break;case Boolean:s[e]=null!=o?"true"===o.toString():null!=i&&i;break;case Object:try{s[e]=null!=o?JSON.parse(o):null!=i?i:void 0}catch(t){s[e]=null!=i?i:void 0,console.error("An object parse issue occurred",t)}}t[e]=s[e],this._instanceProps&&this._instanceProps[e]&&(t[e]=this._instanceProps[e])}),t}_processInitProps(t){const e=this,s=["state","created","mounted","updated","removed","render"],r=Object.keys(t);r.length&&r.forEach(r=>{e[r]||"function"!=typeof t[r]||s.includes(r)||(e[r]=t[r].bind(e)),"computed"===r&&this._processComputed(t[r])})}_processRoot(t){switch(t){case"standard":default:return this;case"shadow":return this.attachShadow({mode:"open"});case"shadow:closed":return this.attachShadow({mode:"closed"})}}_processComputed(t){const e=this,s=Object.keys(t);s.length&&s.forEach(s=>{e[s]?console.warn(`Computed property '${s}' already exists on the component instance`):Object.defineProperty(e,s,{get:()=>(e.computedCache[s]||(e.computedCache[s]=t[s].bind(e)()),e.computedCache[s])})})}_processRender(){const t=this.render?this.render():void 0;t&&(this.template=t,this._updateRender())}_monitorState(t){const e=this;return new Proxy(t,{set:(t,s,r)=>(t[s]===r||(t[s]=r,e.computedCache={},e._processRender()),!0)})}_processSlots(){const t=this.childNodes,e={default:[]};return t.length>0&&[...t].forEach(t=>{const s=t.getAttribute?t.getAttribute("slot"):null;s?e[s]=t:e.default.push(t)}),e}_getAttribute(e){try{return this.getAttribute(t(e))}catch(t){return console.error("A get prop error occurred",t),""}}_processInstanceProps(e){const s=this,r=Object.keys(e);e&&r.forEach(e=>{s[e]?console.warn(`Instance property '${e}' already exists on the component instance`):Object.defineProperty(s,e,{get(){return this._instanceProps&&this._instanceProps[e]?this._instanceProps[e]:this.getAttribute(t(e))},set(s){return this._instanceProps||(this._instanceProps={}),this._instanceProps[e]=s,this.setAttribute(t(e),"object"==typeof s?JSON.stringify(s):s.toString()),this.attributeChangedCallback(),!0},enumerable:!0})})}_preprocess(){this.computedCache={},this.props=this._processProps(),this._processRender()}_updateRender(){var t;this.template&&("object"!=typeof(t=this.template)&&"function"!=typeof t||"function"!=typeof t.then?this.templateRenderer(this.template,this.root):this.template.then(t=>this.templateRenderer(t,this.root)).catch(t=>console.error("A component render error occurred",t)))}})}export{e as createComponent};
